1. 인덱스 설정의 단점에 관해서 설명해주세요.

> 문진수
>
> 인덱스는 데이터를 효율적으로 조회하기 위해 사용되는 자료구조입니다. MySQL의 경우 B+Tree를 기본으로 사용하여 주어진 키 순서로 정렬하여 저장합니다. CUD 성능을 희생하고 R의 성능을 극대화하는 목적으로 사용됩니다. 서비스의 특성을 고려하여 Read, Wrtie 비율을 적절하게 따져서 인덱스를 설정하는 것이 중요합니다.

> 백명규
> 
> 인덱스를 설정했을 때의 단점은 인덱스를 위한 추가적인 디스크 공간을 사용을 해야 합니다. 
> 또한 특히 인덱스의 순서랑 실제 물리적인 데이터의 위치가 일치하지 않기 때문에 기준이 되는 컬럼 데이터가 변경이 되는 경우 모든 인덱스 구조에 대해서 변경하는 과정의 비용이 추가적으로 발생합니다.
> 
> ※ 이런 문제 때문에 데이터를 많이 넣어야 하는 경우에는 일부러 인덱스를 잠깐 내리고 그 다음에 데이터를 모두 넣고 인덱스를 다시 넣는 방식의 튜닝도 존재함.

---
2. 인덱스를 통해서 회원 데이터를 조회해오려고 합니다. 
이 때, 고를 수 있는 컬럼이 성별, 회원명, 가입일이 있을 때 어떻게 인덱스를 설정하실건가요? 그 이유도 함께 설명 부탁드립니다.

> 문진수
>
> 각 칼럼들의 카디널리티, 그리고 요구사항에 있는 쿼리들의 정렬 기준, 그룹핑 등 상황마다 너무 달라질 거 같습니다. 만약 카디널리티를 따지고 본다면 (가입일, 회원명, 성별)로 인덱스를 구성할 거 같습니다.

> 백명규
> 
> 저는 성별, 회원명, 가입일 순 혹은 회원명, 성별, 가입일 순으로 설정을 할 것 같습니다. 
> 일단 가입일은 정렬용으로 사용할 것 같으니 가장 뒤로 두고 성별과 회원명에 대해서만 이야기를 해보겠습니다. 
> 해당 테이블에 위에서 언급한 컬럼만 존재한다고 하면 성별, 회원명으로 둘 것 같습니다. 
> 왜냐하면 성별, 회원명으로 두건 회원명, 성별로 두건 조회를 해올 때 equal 조건으로 가져오는 경우에는 똑같습니다. 
> 대신 위처럼 두면 데이터가 아주 큰 경우에는 조금 더 의미있는 범위 조회가 가능하다고 생각을 합니다. 
> 예를 들면, 특정한 이름에 대해서 성별로 데이터를 조회하는 건 의미가 나쁘지만, 남성에 대해서 김씨부터 박씨까지 데이터를 가져와라 이런식으로 정렬된 데이터를 인덱스를 통해서 가져올 수 있습니다. 
> 반면, 회원명, 성별로 두는 경우는 데이터를 좁히기 위함이라고 생각을 합니다. 
> 특히 인덱스 선두 컬럼에 범위를 크게 좁힐 수 있는 조건을 넣으면 인덱스 개수를 최소화하고 추가적인 데이터 조건에 대해서는 내부에서 체크하여 필터링할 수 있게 설정할 수 있습니다. 
> 그래서 해당 컬럼만 존재하는 테이블이냐 아니냐 이렇게 상황을 두 가지로 나누어 보아야 한다고 생각을 합니다.

---
3. 인덱스를 사용하지 못하는 경우에 대해서 말씀해주실 수 있으실까요?

> 문진수
>
> 조건절에 인덱스 선두 컬럼이 없는 경우 인덱스를 제대로 사용하기 어려울 수 있습니다. 인덱스 왼쪽 컬럼 기준으로 오른쪽 컬럼들이 정렬되기 때문에 선두 컬럼 조건이 존재하지 않으면 안됩니다. 또한 레코드 개수가 너무 적어서 페이지 하나에 모든 데이터가 들어간다면 Full Table Scan 실행계획이 잡힙니다. 그리고 전체 조회 비율중에 너무 많은 데이터를 가져오려고 할 때도 인덱스를 사용하지 않는 실행계획이 잡힙니다. 인덱스를 사용할 경우 실제 데이터를 가져오는 과정에서 Disk Random I/O가 발생하기 때문입니다. (대략 전체의 25%) 또한 함수를 사용하여 값을 바꾸는 경우도 인덱스를 사용할 수 없고 like절로 조회할 때 ‘%hello’와 같이 왼쪽 값을 확정할 수 없을 때는 인덱스를 활용할 수 없습니다.

> 백명규
> 
> 조회 과정에서 인덱스를 사용하지 못하는 기본적인 경우에는 이런 경우가 있을 거 같습니다. 
> 첫 번째로는 데이터 전체나 테이블 내에서 많은 데이터를  읽어야 하는 경우입니다. 
> 연도가 지나 모든 고객님들의 포인트가 소멸되는 경우와 같은 그런 경우에는 인덱스를 통해 조회하는 것보다 모든 데이터를 순차적으로 보는 게 효율적이기 때문에 옵티마이저가 Full Table Scan을 선택할 겁니다.
> 이런 경우를 제외하고는 WHERE 절의 인덱스 선두컬럼과 일치하는 순서대로 되지 않는 경우, 범위조건이 여러 개 달려 있는 경우, ORDER BY절과 WHERE절을 종합해봤을 때 인덱스의 순서와 일치하지 않는 경우 등이 있을 거 같습니다.

---
4. 프로젝트를 진행하면서 인덱스를 설정해본 경험에 대해서 설명해주세요.

> 문진수
>
> 상품 리스트를 조회할 때 현재 입찰가 순으로 리스트를 조회해야하는 요구사항이 있었습니다. 저는 (입찰가, PK)를 multi column index로 설정하여 no-offset pagination 처리를 했습니다.

---
5. 특정 테이블에 인덱스 개수가 많을 수록 좋은 지, 적을 수록 좋은 지 의견에 관해서 말씀해주세요.

> 문진수
>
> 인덱스가 많으면 Write 성능이 안좋아집니다. 실제로 많이 사용되고 병목이 발생하는 slow query를 분석하여 인덱스를 적용하는 것이 좋습니다.

---
6. 인덱스를 설정할 때의 트레이드 오프에 관해서 설명해주세요.

> 문진수
>
> 인덱스를 사용하면 log시간에 데이터를 찾을 수 있어서 Read 속도가 빨라집니다. 하지만 반대로 Write 성능은 떨어지기 때문에 서비스의 특성에 맞추어 적절하게 인덱스를 설정하는 것이 중요합니다. 일반적인 OLPT 서비스의 경우 Read : Write = 8(9) : 2(1)이기 때문에 인덱스를 설정하면 얻는 이익이 큽니다.

---